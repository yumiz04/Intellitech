
// Usar la base de datos
use("intellitech-retail")

// Crear la colección de devoluciones
db.createCollection("devoluciones", {
    validator: {
        $jsonSchema: {
            bsonType: "object",
            required: ["fecha_devolucion", "id_tipo_devolucion", "id_cliente", "detalle_devolucion"],
            properties: {
                id_devolucion: {
                    bsonType: "objectId",
                    description: "ID único de la devolución"
                },
                fecha_devolucion: {
                    bsonType: "date",
                    description: "Fecha de la devolución"
                },
                id_tipo_devolucion: {
                    bsonType: "objectId",
                    description: "Referencia al tipo de devolución"
                },
                detalle_devolucion: {
                    bsonType: "object",
                    required: ["cantidad", "estado_producto", "id_producto"],
                    properties: {
                        cantidad: {
                            bsonType: "int",
                            description: "Cantidad de productos devueltos"
                        },
                        estado_producto: {
                            bsonType: "string",
                            enum: ["defectuoso", "no funcional", "otros"],
                            description: "Estado del producto devuelto"
                        },
                        id_producto: {
                            bsonType: "objectId",
                            description: "ID del producto"
                        }
                    }
                },
                id_cliente: {
                    bsonType: "objectId",
                    description: "ID del cliente que realiza la devolución"
                }
            }
        }
    }
});

// Crear índice para id_producto
db.devoluciones.createIndex(
    { "detalle_devolucion.id_producto": 1 }
);

// Crear índice para id_cliente
db.devoluciones.createIndex(
    { id_cliente: 1 }
);

// Crear índice para id_tipo_devolucion
db.devoluciones.createIndex(
    { id_tipo_devolucion: 1 }
);
