
// Usar la base de datos
use("intellitech-retail");

// Crear la colección de proveedores con referencia a direcciones
db.createCollection("proveedores", {
    validator: {
        $jsonSchema: {
            bsonType: "object",
            required: ["nombre_proveedor", "contacto", "id_direccion"],
            properties: {
                id_proveedor: {
                    bsonType: "int",
                    description: "ID único del proveedor"
                },
                nombre_proveedor: {
                    bsonType: "object",
                    required: ["primer_nombre", "apellido_paterno", "apellido_materno"],
                    properties: {
                        primer_nombre: {
                            bsonType: "string",
                            description: "Primer nombre del proveedor"
                        },
                        apellido_paterno: {
                            bsonType: "string",
                            description: "Apellido paterno del proveedor"
                        },
                        apellido_materno: {
                            bsonType: "string",
                            description: "Apellido materno del proveedor"
                        }
                    }
                },
                contacto: {
                    bsonType: "object",
                    required: ["telefono", "correo"],
                    properties: {
                        telefono: {
                            bsonType: "array",
                            description: "Teléfonos de contacto del proveedor",
                            minItems: 1,
                            maxItems: 3,
                            uniqueItems: true,
                            items: {
                                bsonType: "string",
                                pattern: "^(\\+\\d{1,3}[- ]?)?\\d{10}$" // Valida lada internacional opcional y 10 dígitos
                            }
                        },
                        correo: {
                            bsonType: "string",
                            description: "Correo electrónico del proveedor",
                            pattern: "^[A-Za-z\\d.-]+@[A-Za-z\\d.-]+\\.[A-Za-z]{2,}$" // Valida el correo estándar
                        }
                    }
                },
                id_direccion: {
                    bsonType: "int",
                    description: "Referencia al ID de la dirección del proveedor en la colección direcciones_proveedores"
                }
            }
        }
    }
});

// Crear índices para optimizar consultas en la colección de proveedores
db.proveedores.createIndex(
    { "contacto.telefono": 1 }
);

db.proveedores.createIndex(
    { "nombre_proveedor.primer_nombre": 1, "nombre_proveedor.apellido_paterno": 1 }
);
